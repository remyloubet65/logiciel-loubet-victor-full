<!doctype html>
<html lang="fr">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PFV ‚Äî Test App Minimal</title>

<style>
  body{font-family:system-ui,Arial;margin:24px;max-width:900px}
  .box{border:1px solid #ddd;border-radius:12px;padding:16px;margin:12px 0}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid #eee;padding:6px;text-align:left}
  button{padding:8px 12px;border:1px solid #ccc;border-radius:8px;background:#f7f7f7;cursor:pointer}
</style>

<h1>PFV ‚Äî Test App Minimal</h1>
<div class="box"><b>Connexion Supabase :</b> <span id="status">‚è≥ Initialisation‚Ä¶</span></div>
<div class="box">
  <button id="btn">üîÑ Recharger la liste</button>
  <div id="out"></div>
</div>

<!-- UMD ‚Äì m√™me CDN que la page DEBUG qui fonctionne -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
<script>
  const statusEl = document.getElementById('status');
  const out = document.getElementById('out');

  // üîß Tes vraies valeurs (URL corrig√©e avec le "y")
  const SUPABASE_URL = "https://aoidadxujanyxpxctbyvb.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvaWRhZHh1amFueHB4Y3RieXZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzMDYyNzYsImV4cCI6MjA3NDg4MjI3Nn0.Iaf6J_KzUzRNddUE6Mq6xTJW0xKc7eR6FU3OtW2CwHw";

  let sb;
  try {
    sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  } catch (e) {
    statusEl.textContent = "‚ùå Init client: " + (e?.message || e);
    throw e;
  }

  async function pingAndList(){
    try {
      statusEl.textContent = "üîé Test SELECT‚Ä¶";
      const { data, error } = await sb.from('decedents').select('*').order('created_at',{ascending:false}).limit(50);
      if (error) { statusEl.textContent = "‚ùå SELECT decedents: " + error.message; out.innerHTML=""; return; }
      statusEl.textContent = "‚úÖ Pr√™t (cl√© anonyme)";
      out.innerHTML = `<table><thead><tr><th>Nom</th><th>Pr√©nom</th><th>Date d√©c√®s</th></tr></thead><tbody>${
        (data||[]).map(d=>`<tr><td>${d.lastname}</td><td>${d.firstname}</td><td>${d.date_of_death||''}</td></tr>`).join('')
      }</tbody></table>`;
    } catch (e) {
      statusEl.textContent = "‚ùå Fetch error: " + (e?.message || e);
    }
  }

  document.getElementById('btn').onclick = pingAndList;
  pingAndList();
</script>
</html>
