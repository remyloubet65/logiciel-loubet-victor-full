<!doctype html>
<meta charset="utf-8">
<title>PFV — DEBUG Supabase</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,Arial;margin:24px;max-width:900px}
  .box{border:1px solid #ddd;border-radius:12px;padding:16px;margin:12px 0}
  .ok{color:#13721e}.err{color:#b00020}
  pre{background:#f7f7f7;padding:10px;border-radius:8px}
</style>

<h1>PFV — DEBUG Supabase</h1>
<div class="box">
  <div><strong>Statut :</strong> <span id="status">⏳ Initialisation…</span></div>
  <div id="details"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
<script>
const statusEl = document.getElementById('status');
const detailsEl = document.getElementById('details');

const SUPABASE_URL = "https://aoidadxujanyxpxctbyvb.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvaWRhZHh1amFueHB4Y3RieXZiIiwicm9zZSI6ImFub24iLCJpYXQiOjE3NTkzMDYyNzYsImV4cCI6MjA3NDg4MjI3Nn0.Iaf6J_KzUzRNddUE6Mq6xTJW0xKc7eR6FU3OtW2CwHw";

(async () => {
  try {
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    statusEl.textContent = "🔎 Test…";
    const r1 = await sb.from('decedents').select('id').limit(1);
    if (r1.error) { statusEl.innerHTML = '<span class="err">❌ '+r1.error.message+'</span>'; return; }
    const r2 = await sb.from('prestations').select('id').limit(1);
    if (r2.error) { statusEl.innerHTML = '<span class="err">❌ '+r2.error.message+'</span>'; return; }
    statusEl.innerHTML = '<span class="ok">✅ Connecté à Supabase</span>';
    detailsEl.innerHTML = '<pre>'+JSON.stringify({
      decedents_rows: (r1.data||[]).length,
      prestations_rows: (r2.data||[]).length
    }, null, 2)+'</pre>';
  } catch(e){
    statusEl.innerHTML = '<span class="err">❌ '+(e.message||e)+'</span>';
  }
})();
</script>
