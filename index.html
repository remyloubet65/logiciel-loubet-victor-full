<!doctype html>
<meta charset="utf-8">
<title>PFV ‚Äî DEBUG Supabase</title>
<style>
  body{font-family:system-ui,Arial;margin:24px;max-width:900px}
  code{background:#f4f4f4;padding:2px 6px;border-radius:6px}
  .ok{color:#13721e} .err{color:#b00020}
  .box{border:1px solid #ddd;border-radius:12px;padding:16px;margin:12px 0}
</style>

<h1>PFV ‚Äî DEBUG Supabase</h1>

<div class="box">
  <div><strong>Statut :</strong> <span id="status">‚è≥ Initialisation‚Ä¶</span></div>
  <div id="details"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const statusEl = document.getElementById('status');
const detailsEl = document.getElementById('details');
const set = (html)=>detailsEl.innerHTML = html;
const mask = (s)=>!s ? '(vide)' : s.length<=12 ? s : s.slice(0,8)+'‚Ä¶'+s.slice(-4);

// ‚¨áÔ∏è RENSEIGNE BIEN TES VALEURS ICI
const SUPABASE_URL = "https://aoidadxujanxpxctbyvb.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvaWRhZHh1amFueHB4Y3RieXZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzMDYyNzYsImV4cCI6MjA3NDg4MjI3Nn0.Iaf6J_KzUzRNddUE6Mq6xTJW0xKc7eR6FU3OtW2CwHw";
function showEnv(){
  set(`
    <p>URL: <code>${mask(SUPABASE_URL)}</code></p>
    <p>Key: <code>${mask(SUPABASE_ANON_KEY)}</code> (len=${(SUPABASE_ANON_KEY||'').length})</p>
  `);
}
showEnv();

(async function run(){
  try{
    if(!SUPABASE_URL || !SUPABASE_ANON_KEY){
      statusEl.innerHTML = '<span class="err">‚ùå URL ou cl√© manquante</span>'; return;
    }
    if(!/^https:\/\/.*\.supabase\.co$/.test(SUPABASE_URL)){
      statusEl.innerHTML = '<span class="err">‚ùå Mauvais format d‚ÄôURL Supabase</span>'; return;
    }

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    statusEl.textContent = 'üîé Test SELECT‚Ä¶';

    // Test 1 : ping d√©c√©dents
    const r1 = await sb.from('decedents').select('*').limit(1);
    if(r1.error){
      statusEl.innerHTML = '<span class="err">‚ùå Erreur SELECT decedents</span>';
      set(`<pre>${JSON.stringify(r1.error, null, 2)}</pre>`); return;
    }

    // Test 2 : ping prestations
    const r2 = await sb.from('prestations').select('id').limit(1);
    if(r2.error){
      statusEl.innerHTML = '<span class="err">‚ùå Erreur SELECT prestations</span>';
      set(`<pre>${JSON.stringify(r2.error, null, 2)}</pre>`); return;
    }

    statusEl.innerHTML = '<span class="ok">‚úÖ Connect√© √† Supabase</span>';
    set(`<pre>${JSON.stringify({decedents_rows: r1.data?.length||0, prestations_rows: r2.data?.length||0}, null, 2)}</pre>`);
  }catch(e){
    statusEl.innerHTML = '<span class="err">‚ùå Exception JS</span>';
    set(`<pre>${(e && e.message) ? e.message : String(e)}</pre>`);
  }
})();
</script>
